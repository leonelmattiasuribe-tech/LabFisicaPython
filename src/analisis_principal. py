import numpy as np
import matplotlib.pyplot as plt 
from .ajuste_mmc import calcular_coeficientes_mmc 

## 1. DATOS y LINEALIZACIÓN

# X (Masa relativa)
X_masa = np.array([1.0, 2.0, 3.0, 4.0, 5.0])

# Periodos T (s)
periods = np.array([1.000, 1.414, 1.732, 2.000, 2.236]) 

# Y (T^2) - Variable linealizada
Y_T2 = periods**2 

print("--- Proceso de Linealización ---")
print(f"Datos X (masa): {X_masa}")
print(f"Datos Linealizados Y (T^2): {Y_T2}")


## 2. AJUSTE DE MMC (Cálculo de A, B y Errores)

# Llama a la función y recibe los 4 valores
A, B, sigma_A, sigma_B = calcular_coeficientes_mmc(X_masa, Y_T2) 

print("\n--- Resultados del Ajuste MMC ---")
print(f"Coeficiente A (Corte): {A:.4f} +- {sigma_A:.4f}")
print(f"Coeficiente B (Pendiente): {B:.4f} +- {sigma_B:.4f}")
print("----------------------------------")


## 3. CÁLCULO FINAL PARA EL INFORME (Constante k y su Error)

# La fórmula es B = 4*pi^2 / k. Por lo tanto, k = 4*pi^2 / B
k = (4 * np.pi**2) / B

# Propagación de error para k: sigma_k = k * (|sigma_B / B|)
sigma_k = k * np.abs(sigma_B / B)

print("\n--- Resultado Final: Constante del Resorte (k) ---")
print(f"Constante k: {k:.4f} +- {sigma_k:.4f}")
print("--------------------------------------------------")


## 4. GRÁFICA DE DATOS LINEALIZADOS Y AJUSTE

# Generar puntos para la línea de ajuste (Y = A + B * X)
X_fit = np.linspace(X_masa.min(), X_masa.max(), 100) 
Y_fit = A + B * X_fit

# Crear el gráfico
plt.figure(figsize=(10, 6)) 

# Puntos Experimentales
plt.plot(X_masa, Y_T2, 
         'bo', 
         label='Datos Experimentales Linealizados') 

# Línea de Ajuste (MMC)
plt.plot(X_fit, Y_fit, 
         'r-', 
         label=f'Ajuste Lineal: $T^2 = ({A:.4f}) + ({B:.4f})m$') 

# Etiquetas y Título 
plt.title('Linealización de Periodo al Cuadrado ($T^2$) vs Masa ($m$)')
plt.xlabel('Masa (unidades relativas)')
plt.ylabel('Periodo al Cuadrado $T^2$ ($s^2$)')
plt.legend()
plt.grid(True) 

# Guarda la imagen (para el informe)
plt.savefig('grafico_analisis_principal.png')

print("\nAnálisis Principal COMPLETO. Gráfico generado.")
